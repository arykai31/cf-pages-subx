# 实现完整的路由守卫功能

## 现状分析

* 项目使用React Router v6

* 非嵌套路由：`/login`（不需要登录）

* 嵌套路由：`/`, `/settings`, `/profile`（使用AppLayout布局）

* 退出登录时会清除localStorage中的token并跳转到登录页

* 当前路由守卫实现存在问题：登录后使用返回功能依旧会跳转到登录页面

* 问题原因：
  - AppLayout组件的useEffect只在组件挂载时运行一次，不会监听token变化
  - 登录页面没有检查token存在性，已登录用户可以访问登录页
  - 缺少对token变化的监听机制

## 实现步骤

### 1. 修改AppLayout.tsx文件

* 导入useNavigate和useEffect钩子

* 在组件中添加token检查逻辑：
  - 检查localStorage中是否存在authToken
  - 如果token不存在，使用useNavigate跳转到/login
  - 使用useEffect钩子监听组件挂载

### 2. 修改LoginPage.tsx文件

* 在LoginPage组件中添加token检查逻辑：
  - 检查localStorage中是否存在authToken
  - 如果token存在，使用useNavigate跳转到主页
  - 使用useEffect钩子监听组件挂载和token变化

### 3. 确保逻辑正确

* AppLayout：只允许已登录用户访问受保护页面
* LoginPage：只允许未登录用户访问登录页面
* 确保重定向逻辑不会导致无限循环

## 预期结果

* 退出登录后，用户无法通过浏览器返回按钮访问受保护的页面

* 未登录用户直接访问受保护页面时，会被重定向到登录页

* 已登录用户访问登录页面时，会被重定向到主页

* 登录用户可以正常访问所有受保护页面

* 登录后使用返回按钮不会回到登录页面

## 注意事项

* 确保代码符合项目的编码规范

* 保持与现有代码风格一致

* 确保功能的完整性和稳定性

* 确保重定向逻辑不会导致无限循环

