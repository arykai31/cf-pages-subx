- # 项目设计文档

  ## 1. 项目概述

  ### 1.1 项目目标与范围

  **一句话描述**：
  "一个简单的订阅系统，可以按时间推送消息到微信，支持用户管理、订阅配置和多渠道推送。"

  **详细描述**：

  - 本项目旨在构建一个轻量级的订阅管理系统，允许用户通过简单界面配置订阅规则，并在指定时间自动推送消息到微信（包括微信公众号和企业微信）。
  - 系统将专注于核心功能：用户管理、订阅配置、消息推送，不涉及复杂的统计分析或高级管理功能。
  - 项目边界：
    - **包含**：用户注册/登录、订阅配置、消息推送设置、基础数据展示
    - **不包含**：用户社交功能、高级数据分析、第三方API集成（如微信支付）
    - **技术边界**：仅使用Cloudflare Workers作为后端，不涉及传统服务器部署

  **项目价值**：

  - 为用户提供便捷的定时消息推送功能
  - 简化消息推送配置流程，减少人工干预
  - 为后续扩展提供清晰的架构基础

  ------

  ## 2. 需求分析

  ### 2.1 功能需求

  | 功能模块     | 详细需求                                                     | 优先级 | 是否必要 | 备注                         |
  | ------------ | ------------------------------------------------------------ | ------ | -------- | ---------------------------- |
  | **登录页面** | - 用户账号密码登录 - 密码可见/隐藏切换按钮 - 重置密码功能（链接到邮件） - 登录状态保持 | 高     | 必须     | 使用JWT实现会话管理          |
  | **订阅页面** | - 顶部导航栏（Logo、首页、订阅、设置、个人中心） - 订阅列表展示（标题、时间、状态） - 添加订阅按钮 - 订阅状态切换（启用/禁用） - 页脚（版权信息、版本号） | 高     | 必须     | 使用Tailwind原子化样式       |
  | **设置页面** | - 农历显示开关（启用/禁用） - 推送配置开关（启用/禁用） - 推送渠道选择（微信、企业微信） - 推送时间配置（自定义时间或固定时间） - 保存配置按钮 | 中     | 必须     | 采用组件化设计，避免重复代码 |
  | **个人中心** | - 用户头像上传/修改 - 账号信息展示 - 手机号修改 - 密码修改（包含确认密码） - 退出登录按钮 | 低     | 可选     | 作为后续迭代功能             |

  ### 2.2 非功能需求

  | 需求类型     | 具体要求                                                  |
  | ------------ | --------------------------------------------------------- |
  | **性能**     | - 页面加载时间 < 2秒（首次加载） - 列表数据加载时间 < 1秒 |
  | **响应式**   | - 支持移动端（手机和平板） - 适配不同屏幕尺寸             |
  | **安全性**   | - 密码加密存储（前端哈希+后端加密） - 敏感操作需二次验证  |
  | **易用性**   | - 界面简洁直观，符合用户习惯 - 操作步骤不超过3步          |
  | **可维护性** | - 代码结构清晰，组件化设计 - 详细注释和文档               |

  ------

  ## 3. 系统设计

  ### 3.1 整体架构

  ```
  ┌─────────────────────────────────────────────────────────────────────────┐
  │                          前端 (Cloudflare Pages)                          │
  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
  │  │  Login  │  │  Home   │  │  Settings │  │  Profile  │  │  API    │      │
  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘      │
  └─────────────────────────────────────────────────────────────────────────┘
                    │
                    ▼
  ┌─────────────────────────────────────────────────────────────────────────┐
  │                          后端 (Cloudflare Workers)                        │
  │  ┌─────────────────────────────────────────────────────────────────────┐  │
  │  │                     API Gateway (Routing)                           │  │
  │  ├─────────────────────────────────────────────────────────────────────┤  │
  │  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐       │  │
  │  │  │  Auth     │  │  Subscriptions │  │  Settings │  │  User     │  │  │
  │  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘       │  │
  │  └─────────────────────────────────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────────────────────────────┘
  ```

  ### 3.2 模块设计

  #### 3.2.1 前端模块

  | 模块       | 功能描述                 | 依赖                |
  | ---------- | ------------------------ | ------------------- |
  | `Login`    | 用户登录认证界面         | `Auth` API          |
  | `Home`     | 订阅列表展示界面         | `Subscriptions` API |
  | `Settings` | 系统配置界面             | `Settings` API      |
  | `Profile`  | 个人中心界面             | `User` API          |
  | `Layout`   | 全局布局（导航栏、页脚） | 无                  |

  #### 3.2.2 后端模块

  | 模块            | 功能描述                                 | 依赖                   |
  | --------------- | ---------------------------------------- | ---------------------- |
  | `Auth`          | 用户认证（登录、注册、token管理）        | `User` 数据库          |
  | `Subscriptions` | 订阅管理（创建、编辑、删除、状态切换）   | `Subscriptions` 数据库 |
  | `Settings`      | 系统设置（农历显示、推送渠道配置）       | `Settings` 数据库      |
  | `User`          | 用户信息管理（头像、账号、手机号、密码） | `User` 数据库          |

  ### 3.3 数据模型

  #### 3.3.1 用户表 (`users`)

  | 字段            | 类型      | 描述       | 必填 |
  | --------------- | --------- | ---------- | ---- |
  | `id`            | string    | 用户唯一ID | 是   |
  | `username`      | string    | 用户名     | 是   |
  | `password_hash` | string    | 密码哈希   | 是   |
  | `phone`         | string    | 手机号     | 否   |
  | `avatar_url`    | string    | 头像URL    | 否   |
  | `created_at`    | timestamp | 创建时间   | 是   |

  #### 3.3.2 订阅表 (`subscriptions`)

  | 字段         | 类型      | 描述                         | 必填 |
  | ------------ | --------- | ---------------------------- | ---- |
  | `id`         | string    | 订阅唯一ID                   | 是   |
  | `user_id`    | string    | 用户ID                       | 是   |
  | `title`      | string    | 订阅标题                     | 是   |
  | `time`       | string    | 推送时间（HH:MM）            | 是   |
  | `is_enabled` | boolean   | 是否启用                     | 是   |
  | `channel`    | string    | 推送渠道（wechat, qywechat） | 是   |
  | `created_at` | timestamp | 创建时间                     | 是   |

  ------

  ## 4. 技术选型

  ### 4.1 前端技术栈

  | 技术                 | 选择理由             | 优势                        |
  | -------------------- | -------------------- | --------------------------- |
  | **React**            | 组件化开发，生态丰富 | 代码可维护性高，开发效率高  |
  | **TypeScript**       | 类型安全，减少错误   | 提升代码质量，利于团队协作  |
  | **shadcn/ui**        | 基于Tailwind的组件库 | 快速构建UI，样式一致        |
  | **Tailwind CSS**     | 原子化样式，开发高效 | 减少CSS编写时间，响应式支持 |
  | **Cloudflare Pages** | 无服务器部署，成本低 | 部署简单，全球CDN加速       |

  ### 4.2 后端技术栈

  | 技术                   | 选择理由               | 优势                              |
  | ---------------------- | ---------------------- | --------------------------------- |
  | **Cloudflare Workers** | 无服务器架构，按需计费 | 适合小型项目，部署简单，成本低    |
  | **D1 Database**        | 云原生SQLite数据库     | 与Workers无缝集成，无需管理数据库 |
  | **JWT**                | 安全的认证机制         | 无状态，适合分布式系统            |

  ### 4.3 开发工具

  | 工具         | 用途                 |
  | ------------ | -------------------- |
  | **Vite**     | 项目构建和开发服务器 |
  | **ESLint**   | 代码质量检查         |
  | **Prettier** | 代码格式化           |
  | **Git**      | 版本控制             |
  | **GitHub**   | 代码托管和协作       |

  ------

  ## 5. 开发计划

  ### 5.1 迭代计划

  | 迭代      | 任务                                                    | 优先级 | 预计时间 | 产出               |
  | --------- | ------------------------------------------------------- | ------ | -------- | ------------------ |
  | **迭代1** | - 创建项目结构 - 配置Tailwind和shadcn/ui - 实现基础布局 | 高     | 4小时    | 可运行的前端框架   |
  | **迭代2** | - 实现用户登录功能 - 实现用户注册功能                   | 高     | 6小时    | 可用的用户认证系统 |
  | **迭代3** | - 实现订阅页面基础布局 - 实现订阅数据展示               | 中     | 6小时    | 订阅列表功能       |
  | **迭代4** | - 实现设置页面 - 实现农历显示开关功能                   | 中     | 4小时    | 系统配置功能       |
  | **迭代5** | - 实现个人中心基础功能 - 实现头像上传功能               | 低     | 4小时    | 个人中心功能       |

  ### 5.2 任务分解

  #### 迭代1：基础环境搭建

  -  创建Vite项目（React + TypeScript）
  -  安装Tailwind CSS和shadcn/ui
  -  配置Tailwind和shadcn/ui
  -  创建基础布局组件（Header、Footer）
  -  配置路由（使用React Router）

  #### 迭代2：用户认证

  -  创建用户注册页面
  -  创建用户登录页面
  -  实现JWT认证流程
  -  创建用户API（Cloudflare Workers）
  -  实现会话管理

  #### 迭代3：订阅功能

  -  创建订阅列表页面
  -  实现订阅数据展示
  -  创建添加订阅表单
  -  实现订阅状态切换功能
  -  创建订阅API

  #### 迭代4：系统配置

  -  创建设置页面
  -  实现农历显示开关
  -  实现推送渠道配置
  -  实现推送时间配置
  -  创建设置API

  #### 迭代5：个人中心

  -  创建个人中心页面
  -  实现用户信息展示
  -  实现头像上传功能
  -  实现手机号修改功能
  -  实现密码修改功能

  ------

  ## 6. 环境准备

  ### 6.1 开发环境配置

  1. **安装依赖**

     ```bash
     # 创建Vite项目
     npx create-vite subscription-system --template react-ts
     cd subscription-system
     
     # 安装Tailwind CSS
     npm install tailwindcss @tailwindcss/vite

     # 安装图标库
     npm install lucide-react
     
     # 初始化shadcn/ui
     npx shadcn@latest init
     ```

  2. **配置Tailwind**
     `src/index.css`：

     ```js
     @import "tailwindcss";
     ```

  3. **配置shadcn/ui**

     ```bash
     npx shadcn-ui@latest add button
     npx shadcn-ui@latest add card
     npx shadcn-ui@latest add input
     ```

  4. **创建基础组件**

     - `src/presentation/components/layout/Header.tsx`
     - `src/presentation/components/layout/Footer.tsx`
     - `src/presentation/components/layout/Layout.tsx`

  5. **配置路由**
     - `src/presentation/components/layouts/AppLayout.tsx`
     ```jsx
      import { createBrowserRouter } from "react-router-dom";
      import { AppLayout } from "../src/presentation/components/layouts/AppLayout";
      import { Home } from "../src/presentation/pages/Home";
      import { LoginPage } from "../src/presentation/pages/Login";
      import { Profile } from "../src/presentation/pages/Profile";
      import { Settings } from "../src/presentation/pages/Settings";

      export const router = createBrowserRouter([
        {
          element: <AppLayout />, // 将公共布局放在这里
          children: [
            { path: "/", element: <Home /> },
            { path: "/login", element: <LoginPage /> },
            { path: "/settings", element: <Settings /> },
            { path: "/profile", element: <Profile /> },
          ],
        },
      ]);
     ```

  6. **启动开发服务器**

     ```bash
     npm run dev
     ```

  ### 6.2 部署配置

  1. **配置Cloudflare Pages**
     - 在Cloudflare仪表板中创建新项目
     - 连接GitHub仓库
     - 设置构建命令：`npm run build`
     - 设置输出目录：`dist`
     - 配置环境变量（如API密钥）
  2. **Cloudflare Workers配置**
     - 创建`src/worker.ts`作为Workers入口
     - 配置D1数据库连接
     - 设置路由和API端点

  ------

  ## 7. 项目交付标准

  ### 7.1 代码质量标准

  - 代码符合ESLint规范
  - 代码有必要的注释
  - 组件按功能封装，避免重复代码
  - 使用Tailwind原子化类名，避免CSS文件

  ### 7.2 功能交付标准

  | 功能     | 交付标准                                                 |
  | -------- | -------------------------------------------------------- |
  | 用户登录 | - 支持邮箱/密码登录 - 密码加密存储 - 登录状态保持        |
  | 订阅管理 | - 可添加、编辑、删除订阅 - 可切换订阅状态 - 订阅列表展示 |
  | 系统设置 | - 农历显示开关 - 推送渠道配置 - 推送时间配置             |
  | 个人中心 | - 用户信息展示 - 头像上传 - 密码修改                     |

  ### 7.3 测试标准

  - 所有核心功能通过手动测试
  - 前端在主流浏览器（Chrome、Firefox、Safari）上测试
  - 响应式设计在移动设备上测试
  - 性能测试（页面加载时间 < 2秒）

  ------

  ## 8. 项目里程碑

  | 里程碑           | 时间   | 交付物                 |
  | ---------------- | ------ | ---------------------- |
  | 项目启动         | 第1天  | 项目目标文档、需求文档 |
  | 基础环境搭建     | 第2天  | 可运行的开发环境       |
  | MVP功能完成      | 第5天  | 用户登录、订阅列表功能 |
  | 系统配置功能完成 | 第7天  | 设置页面功能           |
  | 个人中心功能完成 | 第9天  | 个人中心功能           |
  | 项目交付         | 第10天 | 完整可部署的系统       |

  ------

  ## 9. 项目风险与应对

  | 风险         | 影响     | 应对措施                             |
  | ------------ | -------- | ------------------------------------ |
  | 技术选型不当 | 项目延期 | 选择经过验证的技术栈，保持简单       |
  | 需求变更     | 返工增加 | 明确项目边界，严格控制需求变更       |
  | 开发进度延迟 | 交付延期 | 制定合理的迭代计划，定期检查进度     |
  | 部署问题     | 无法上线 | 提前在本地测试部署流程，准备备用方案 |

  ------

  ## 10. 项目文档

  - 项目目标文档
  - 需求文档
  - 系统设计文档
  - 技术选型文档
  - API文档（待开发）
  - 用户手册（待开发）

  ------

  **备注**：本项目采用轻量级架构，专注于核心功能，避免过度设计。所有功能均以"可交付"为原则，确保在有限时间内完成高质量的MVP（最小可行产品）。
